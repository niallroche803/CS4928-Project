@startuml CafePOS Class Diagram
skinparam pageMargin 10
skinparam pageWidth 1400
skinparam pageHeight 1000
scale 0.8
left to right direction
skinparam class {
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
}
skinparam package {
    BackgroundColor LightGray
    BorderColor Black
}
hide empty members
package "com.cafepos.common" {
    class Money {
        - amount: BigDecimal
        + {static} of(double): Money
        + {static} zero(): Money
        + add(Money): Money
        + multiply(int): Money
        + multiply(double): Money
    }
}

package "com.cafepos.catalog" {
    interface Product {
        + id(): String
        + name(): String
        + basePrice(): Money
    }
    
    class SimpleProduct {
        - id: String
        - name: String
        - basePrice: Money
        + SimpleProduct(String, String, Money)
    }
    
    interface Catalog {
        + add(p: Product): void
        + findById(id: String): Optional<Product>
    }
    
    class InMemoryCatalog {
        - byId: HashMap<String, Product>
        + add(Product): void
        + findById(String): Optional<Product>
    }
}

package "com.cafepos.domain" {
    class Order {
        - id: long
        - items: ArrayList<LineItem>
        - observers: ArrayList<OrderObserver>
        + Order(long)
        + addItem(LineItem): void
        + subtotal(): Money
        + pay(PaymentStrategy): void
        + register(OrderObserver): void
        + markReady(): void
        + markItemAdded(): void
        + markPaid(): void
    }
    
    class LineItem {
        - product: Product
        - quantity: int
        + LineItem(Product, int)
        + lineTotal(): Money
    }
    
    class OrderIds {
        - {static} counter: long
        + {static} next(): long
    }
}

package "com.cafepos.demo" {
    class Week6Demo {
        + {static} main(args: String[]): void
        - {static} runInteractiveDemo(): void
    }
}

package "com.cafepos.payment" {
    interface PaymentStrategy {
        + pay(order: Order): void
    }
    
    class CashPayment {
        - cashAmount: Money
        + CashPayment()
        + CashPayment(cashAmount: Money)
        + getCashAmount(): Money
        + pay(order: Order): void
    }
    
    class CardPayment {
        - cardNumber: String
        + CardPayment(cardNumber: String)
        + pay(order: Order): void
    }
    
    class WalletPayment {
        - walletId: String
        + WalletPayment(walletId: String)
        + pay(order: Order): void
    }
}

package "com.cafepos.observers" {
    interface OrderObserver {
        + updated(order: Order, eventType: String): void
    }
    
    interface OrderPublisher {
        + register(o: OrderObserver): void
        + unregister(o: OrderObserver): void
        + notifyObservers(order: Order, eventType: String): void
    }
    
    class KitchenDisplay {
        + updated(order: Order, eventType: String): void
    }
    
    class DeliveryDesk {
        + updated(order: Order, eventType: String): void
    }
    
    class CustomerNotifier {
        + updated(order: Order, eventType: String): void
    }
}

package "com.cafepos.decorator" {
    interface Priced {
        + price(): Money
    }
    
    abstract class ProductDecorator {
        # base: Product
        + ProductDecorator(Product)
    }
    
    class ExtraShot {
        + ExtraShot(Product)
        + price(): Money
    }
    
    class OatMilk {
        + OatMilk(Product)
        + price(): Money
    }
    
    class SizeLarge {
        + SizeLarge(Product)
        + price(): Money
    }
    
    class Syrup {
        + Syrup(Product)
        + price(): Money
    }
}

package "com.cafepos.factory" {
    class ProductFactory {
        + create(recipe: String): Product
    }
    
    class DiscountPolicyFactory {
        + create(type: String): DiscountPolicy
    }
    
    class PaymentStrategyFactory {
        + create(type: String): PaymentStrategy
    }
}

package "com.cafepos.pricing" {
    interface DiscountPolicy {
        + discountOf(subtotal: Money): Money
    }
    
    interface TaxPolicy {
        + taxOn(amount: Money): Money
    }
    
    class PricingService {
        - discountPolicy: DiscountPolicy
        - taxPolicy: TaxPolicy
        + PricingService(DiscountPolicy, TaxPolicy)
        + price(Money): PricingResult
    }
    
    class "PricingService.PricingResult" as PricingResult {
        + subtotal: Money
        + discount: Money
        + tax: Money
        + total: Money
    }
    
    class LoyaltyPercentDiscount {
        - percent: int
        + LoyaltyPercentDiscount(percent: int)
        + discountOf(subtotal: Money): Money
    }
    
    class FixedCouponDiscount {
        - amount: Money
        + FixedCouponDiscount(amount: Money)
        + discountOf(subtotal: Money): Money
    }
    
    class NoDiscount {
        + discountOf(subtotal: Money): Money
    }
    
    class FixedRateTaxPolicy {
        - percent: int
        + FixedRateTaxPolicy(percent: int)
        + taxOn(amount: Money): Money
        + getPercent(): int
    }
    
    class ReceiptPrinter {
        + format(recipe: String, qty: int, pr: PricingResult, taxPercent: int): String
        + print(receipt: String): void
    }
}

package "com.cafepos.checkout" {
    class CheckoutService {
        - factory: ProductFactory
        - pricing: PricingService
        - printer: ReceiptPrinter
        + CheckoutService(...)
        + checkout(String, int, PaymentStrategy): String
    }
}

package "com.cafepos.smells" {
    class OrderManagerGod {
        - factory: ProductFactory
        - discountPolicy: DiscountPolicy
        - taxPolicy: TaxPolicy
        - printer: ReceiptPrinter
        - paymentStrategy: PaymentStrategy
        + OrderManagerGod(factory: ProductFactory, discountPolicy: DiscountPolicy, taxPolicy: TaxPolicy, printer: ReceiptPrinter, paymentStrategy: PaymentStrategy)
        + process(recipe: String, qty: int, paymentType: String, paymentDetails: String, discountCode: String, printReceipt: boolean): String
    }
}

' Relationships
SimpleProduct ..|> Product
InMemoryCatalog ..|> Catalog
InMemoryCatalog --> Product : stores
Order *-- LineItem : contains
LineItem --> Product : references
LineItem --> Money : calculates
Order --> Money : calculates
SimpleProduct --> Money : has basePrice
Money ..|> Comparable
Order --> PaymentStrategy : uses
Order ..|> OrderPublisher
Order --> OrderObserver : notifies
CashPayment ..|> PaymentStrategy
CardPayment ..|> PaymentStrategy
WalletPayment ..|> PaymentStrategy
KitchenDisplay ..|> OrderObserver
DeliveryDesk ..|> OrderObserver
CustomerNotifier ..|> OrderObserver
ProductDecorator ..|> Product
ProductDecorator ..|> Priced
ExtraShot --|> ProductDecorator
OatMilk --|> ProductDecorator
SizeLarge --|> ProductDecorator
Syrup --|> ProductDecorator
ProductFactory --> Product : creates
ProductFactory --> ProductDecorator : creates
DiscountPolicyFactory --> DiscountPolicy : creates
PaymentStrategyFactory --> PaymentStrategy : creates
LoyaltyPercentDiscount ..|> DiscountPolicy
FixedCouponDiscount ..|> DiscountPolicy
NoDiscount ..|> DiscountPolicy
FixedRateTaxPolicy ..|> TaxPolicy
PricingService --> DiscountPolicy : uses
PricingService --> TaxPolicy : uses
PricingService --> PricingResult : creates
CheckoutService --> ProductFactory : uses
CheckoutService --> PricingService : uses
CheckoutService --> ReceiptPrinter : uses
CheckoutService --> PaymentStrategy : uses
OrderManagerGod --> ProductFactory : uses
OrderManagerGod --> DiscountPolicy : uses
OrderManagerGod --> TaxPolicy : uses
OrderManagerGod --> ReceiptPrinter : uses
OrderManagerGod --> PaymentStrategy : uses
CashPayment --> Money : uses
Week6Demo ..> CheckoutService : uses
Week6Demo ..> ProductFactory : uses
Week6Demo ..> Order : createsFactory : uses
Week6Demo --> CheckoutService : uses
Week6Demo --> PricingService : uses
Week6Demo --> ProductFactory : uses
Week6Demo --> OrderManagerGod : uses
Week6Demo --> PaymentStrategy : uses
ProductDecorator ..|> Product
ProductDecorator ..|> Priced
ProductDecorator --> Product : decorates
ExtraShot --|> ProductDecorator
OatMilk --|> ProductDecorator
SizeLarge --|> ProductDecorator
Syrup --|> ProductDecorator
ExtraShot --> Money : uses
OatMilk --> Money : uses
SizeLarge --> Money : uses
Syrup --> Money : uses
ProductFactory --> Product : creates
ProductFactory --> SimpleProduct : creates
ProductFactory --> ExtraShot : creates
ProductFactory --> OatMilk : creates
ProductFactory --> SizeLarge : creates
ProductFactory --> Syrup : creates
DiscountPolicyFactory --> DiscountPolicy : creates
PaymentStrategyFactory --> PaymentStrategy : creates
PricingService --> DiscountPolicy : uses
PricingService --> TaxPolicy : uses
PricingService --> PricingResult : creates
LoyaltyPercentDiscount ..|> DiscountPolicy
FixedCouponDiscount ..|> DiscountPolicy
NoDiscount ..|> DiscountPolicy
FixedRateTaxPolicy ..|> TaxPolicy
ReceiptPrinter --> PricingResult : uses
CheckoutService --> ProductFactory : uses
CheckoutService --> PricingService : uses
CheckoutService --> ReceiptPrinter : uses
CheckoutService --> PaymentStrategy : uses
CheckoutService --> Order : creates
CheckoutService --> LineItem : creates
OrderManagerGod --> ProductFactory : uses
OrderManagerGod --> DiscountPolicy : uses
OrderManagerGod --> TaxPolicy : uses
OrderManagerGod --> ReceiptPrinter : uses
OrderManagerGod --> PaymentStrategy : uses
OrderManagerGod --> Order : creates
OrderManagerGod --> LineItem : creates
OrderManagerGod --> PricingResult : creates

@enduml